{"version":3,"file":"dexie-yield.js","sources":["../C:/Users/David/Documents/GitHub/dexie-es6/addons/dexie-yield/src/dexie-yield.js"],"sourcesContent":["ï»¿\r\nimport Dexie from 'dexie';\r\n\r\nvar Promise = Dexie.Promise;\n\nexport function spawn(generatorFn) {\n    return iterate(generatorFn());\n}\n\nexport function async(generatorFn) {\n    return function () {\n        return iterate(generatorFn.apply(this, arguments));\n    }\n}\n\nexport function iterate (iterable) {\n    var callNext = function (result) { return iterable.next(result); },\n        doThrow = function (error) { return iterable.throw(error); },\n        onSuccess = step(callNext),\n        onError = step(doThrow);\n\n    function step(getNext, initial) {\n        return function (val) {\n            var next = getNext(val);\n            if (next.done)\n                return initial ? Promise.resolve(next.value) : next.value;\n\n            if (!next.value || typeof next.value.then !== 'function')\n                if (Array.isArray(next.value))\n                    return Promise.all(next.value).then(onSuccess, onError);\n                else\n                    return Promise.resolve(next.value).then(onSuccess, onError);\n            return next.value.then(onSuccess, onError);\n        }\n    }\n\n    try {\n        return step(callNext, true)();\n    } catch (e) {\n        return Promise.reject(e);\n    }\n}\n\nDexie.addons.push(function (db) {\n    //\n    // Adjust db.transaction() to handle iterable functions as async without explicitely having to write async() around the transaction scope func:\n    //  db.transaction('rw', db.friends, async(function*(){})); - not needed.\n    //  db.transaction('rw', db.friends, function*(){}); // prettier.\n    //\n    db.transaction = Dexie.override(db.transaction, function (origDbTransaction) {\n        return function () {\n            var scopeFunc = arguments[arguments.length - 1];\n\n            function proxyScope() {\n                var rv = scopeFunc.apply(this, arguments);\n                if (!rv.next || !rv.throw) return rv; // Not an iterable\n                return iterate(rv);\n            }\n\n            proxyScope.toString = function () {\n                return scopeFunc.toString(); // Because original db.transaction may use fn.toString() when error occur.\n            }\n            arguments[arguments.length - 1] = proxyScope;\n            return origDbTransaction.apply(this, arguments);\n        }\n    });\n});\n"],"names":[],"mappings":";;;;;;;;IAGA,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO;;IAEpB,SAAS,KAAK,CAAC,WAAW,EAAE;QAC/B,OAAO,OAAO,CAAC,WAAW,EAAE,CAAC;;;IAG1B,SAAS,KAAK,CAAC,WAAW,EAAE;QAC/B,OAAO,YAAY;YACf,OAAO,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;;;;IAInD,SAAS,OAAO,EAAE,QAAQ,EAAE;QAC/B,IAAI,QAAQ,GAAG,UAAU,MAAM,EAAE,EAAE,OAAO,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE;YAC9D,OAAO,GAAG,UAAU,KAAK,EAAE,EAAE,OAAO,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;YAC5D,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC;YAC1B,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;;QAE3B,SAAS,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE;YAC5B,OAAO,UAAU,GAAG,EAAE;gBAClB,IAAI,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC;gBACvB,IAAI,IAAI,CAAC,IAAI;oBACT,OAAO,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK;;gBAE7D,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,KAAK,UAAU;oBACpD,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC;wBACzB,OAAO,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;;wBAEvD,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;gBACnE,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;;;;QAIlD,IAAI;YACA,OAAO,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE;SAChC,CAAC,OAAO,CAAC,EAAE;YACR,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;;;;IAIhC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;;;;;;QAM5B,EAAE,CAAC,WAAW,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,WAAW,EAAE,UAAU,iBAAiB,EAAE;YACzE,OAAO,YAAY;gBACf,IAAI,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;;gBAE/C,SAAS,UAAU,GAAG;oBAClB,IAAI,EAAE,GAAG,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC;oBACzC,IAAI,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,CAAC;oBACrC,OAAO,OAAO,CAAC,EAAE,CAAC;;;gBAGtB,UAAU,CAAC,QAAQ,GAAG,YAAY;oBAC9B,OAAO,SAAS,CAAC,QAAQ,EAAE,CAAC;;gBAEhC,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,UAAU;gBAC5C,OAAO,iBAAiB,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC;;SAEtD,CAAC;KACL,CAAC,;;;;,;;"}