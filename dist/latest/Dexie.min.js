!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.Dexie={})}(this,function(n){"use strict";function t(n,t){return"object"!=typeof t&&(t=t()),R(t).forEach(function(e){n[e]=t[e]}),n}function e(n){return{from:function(e){return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,{extend:function(r){t(n.prototype,"object"!=typeof r?r(e.prototype):r)}}}}}function r(n,t,e){return U.call(n,t,e)}function o(n,t){return t(n)}function i(n,s){function h(){Tn.on("versionchange",function(n){Tn.close(),Tn.on("error").fire(new yn("Database version changed by other database connection."))})}function g(n){this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function b(n,t,e,i){if(0===n){R(bn).forEach(function(n){C(t,n,bn[n].primKey,bn[n].indexes)});var u=Tn._createTransaction(En,wn,bn);u.idbtrans=t,u.idbtrans.onerror=T(e,["populating database"]),u.on("error").subscribe(e),W.newPSD(function(){W.PSD.trans=u;try{Tn.on("populate").fire(u)}catch(n){i.onerror=t.onerror=function(n){n.preventDefault()};try{t.abort()}catch(r){}t.db.close(),e(n)}})}else{var a=[],c=_n.filter(function(t){return t._cfg.version===n})[0];if(!c)throw new yn("Dexie specification of currently installed DB version is missing");bn=Tn._dbSchema=c._cfg.dbschema;var s=!1,f=_n.filter(function(t){return t._cfg.version>n});f.forEach(function(n){var i=bn,u=n._cfg.dbschema;hn(i,t),hn(u,t),bn=Tn._dbSchema=u;var c=S(i,u);c.add.forEach(function(n){a.push(function(t,e){C(t,n[0],n[1].primKey,n[1].indexes),e()})}),c.change.forEach(function(n){if(n.recreate)throw new yn("Not yet support for changing primary key");a.push(function(t,e){var r=t.objectStore(n.name);n.add.forEach(function(n){z(r,n)}),n.change.forEach(function(n){r.deleteIndex(n.name),z(r,n)}),n.del.forEach(function(n){r.deleteIndex(n)}),e()})}),n._cfg.contentUpgrade&&a.push(function(t,i){s=!0;var a=Tn._createTransaction(En,r(t.db.objectStoreNames),u);a.idbtrans=t;var c=0;a._promise=o(a._promise,function(n){return function(t,e,r){function o(n){return function(){n.apply(this,arguments),0===--c&&i()}}return++c,n.call(this,t,function(n,t,r){arguments[0]=o(n),arguments[1]=o(t),e.apply(this,arguments)},r)}}),t.onerror=T(e,["running upgrader function for version",n._cfg.version]),a.on("error").subscribe(e),n._cfg.contentUpgrade(a),0===c&&i()}),s&&fn()||a.push(function(n,t){V(u,n),t()})});var l=function(){try{a.length?a.shift()(t,l):U(bn,t)}catch(n){i.onerror=t.onerror=function(n){n.preventDefault()};try{t.abort()}catch(r){}t.db.close(),e(n)}};l()}}function S(n,t){var e={del:[],add:[],change:[]};for(var r in n)t[r]||e.del.push(r);for(var r in t){var o=n[r],i=t[r];if(o){var u={name:r,def:t[r],recreate:!1,del:[],add:[],change:[]};if(o.primKey.src!==i.primKey.src)u.recreate=!0,e.change.push(u);else{var a=o.indexes.reduce(function(n,t){return n[t.name]=t,n},{}),c=i.indexes.reduce(function(n,t){return n[t.name]=t,n},{});for(var s in a)c[s]||u.del.push(s);for(var s in c){var f=a[s],l=c[s];f?f.src!==l.src&&u.change.push(l):u.add.push(l)}(u.recreate||u.del.length>0||u.add.length>0||u.change.length>0)&&e.change.push(u)}}else e.add.push([r,i])}return e}function C(n,t,e,r){var o=n.db.createObjectStore(t,e.keyPath?{keyPath:e.keyPath,autoIncrement:e.auto}:{autoIncrement:e.auto});return r.forEach(function(n){z(o,n)}),o}function U(n,t){R(n).forEach(function(e){t.db.objectStoreNames.contains(e)||C(t,e,n[e].primKey,n[e].indexes)})}function V(n,t){for(var e=0;e<t.db.objectStoreNames.length;++e){var r=t.db.objectStoreNames[e];(null===n[r]||void 0===n[r])&&t.db.deleteObjectStore(r)}}function z(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function H(n,t){throw new yn("Table "+t[0]+" not part of transaction. Original Scope Function Source: "+i.Promise.PSD.trans.scopeFunc.toString())}function Y(n,t,e,r){this.name=n,this.schema=e,this.hook=xn[n]?xn[n].hook:m(null,{creating:[f,u],reading:[c,a],updating:[l,u],deleting:[p,u]}),this._tpf=t,this._collClass=r||Z}function G(n,t,e,r){Y.call(this,n,t,e,r||$)}function Q(n,t,e,r){function o(n,t,e,r){return i._promise(n,e,r)}var i=this;this.db=Tn,this.mode=n,this.storeNames=t,this.idbtrans=null,this.on=m(this,["complete","error"],"abort"),this._reculock=0,this._blockedFuncs=[],this._psd=null,this.active=!0,this._dbschema=e,r&&(this.parent=r),this._tpf=o,this.tables=Object.create(Pn);for(var u=t.length-1;-1!==u;--u){var a=t[u],c=Tn._tableFactory(n,e[a],o);this.tables[a]=c,this[a]||(this[a]=c)}}function X(n,t,e){this._ctx={table:n,index:":id"===t?null:t,collClass:n._collClass,or:e}}function Z(n,t){var e=null,r=null;if(t)try{e=t()}catch(o){r=o}var i=n._ctx;this._ctx={table:i.table,index:i.index,isPrimKey:!i.index||i.table.schema.primKey.keyPath&&i.index===i.table.schema.primKey.name,range:e,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:1/0,error:r,or:i.or}}function $(){Z.apply(this,arguments)}function nn(n,t){return n._cfg.version-t._cfg.version}function tn(n,t,e,r,o,i){e.forEach(function(e){var u=Tn._tableFactory(r,o[e],t);n.forEach(function(n){n[e]||(i?Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:function(){var n=W.PSD&&W.PSD.trans;return n&&n.db===Tn?n.tables[e]:u}}):n[e]=u)})})}function en(n){n.forEach(function(n){for(var t in n)n[t]instanceof Y&&delete n[t]})}function rn(n,t,e,r,o,i){var u=W.PSD;i=i||a,n.onerror||(n.onerror=T(o)),t?n.onsuccess=_(function(u){var a=n.result;if(a){var c=function(){a["continue"]()};t(a,function(n){c=n},r,o)&&e(i(a.value),a,function(n){c=n}),c()}else r()},o,u):n.onsuccess=_(function(t){var o=n.result;if(o){var u=function(){o["continue"]()};e(i(o.value),o,function(n){u=n}),u()}else r()},o,u)}function on(n){var t=[];return n.split(",").forEach(function(n){n=n.trim();var e=n.replace("&","").replace("++","").replace("*",""),r=0!==e.indexOf("[")?e:n.substring(n.indexOf("[")+1,n.indexOf("]")).split("+");t.push(new B(e,r||null,-1!==n.indexOf("&"),-1!==n.indexOf("*"),-1!==n.indexOf("++"),M(r),-1!==r.indexOf(".")))}),t}function un(n,t){return t>n?-1:n>t?1:0}function an(n,t){return t>n?1:n>t?-1:0}function cn(n){return function(t,e){for(var r=0;;){var o=n(t[r],e[r]);if(0!==o)return o;if(++r,r===t.length||r===e.length)return n(t.length,e.length)}}}function sn(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}function fn(){return navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0}function ln(){if(Tn.verno=Sn.version/10,Tn._dbSchema=bn={},wn=r(Sn.objectStoreNames,0),0!==wn.length){var n=Sn.transaction(F(wn),"readonly");wn.forEach(function(t){for(var e=n.objectStore(t),r=e.keyPath,o=r&&"string"==typeof r&&-1!==r.indexOf("."),i=new B(r,r||"",!1,!1,!!e.autoIncrement,r&&"string"!=typeof r,o),u=[],a=0;a<e.indexNames.length;++a){var c=e.index(e.indexNames[a]);r=c.keyPath,o=r&&"string"==typeof r&&-1!==r.indexOf(".");var s=new B(c.name,r,!!c.unique,!!c.multiEntry,!1,r&&"string"!=typeof r,o);u.push(s)}bn[t]=new N(t,i,u,{})}),tn([xn],Tn._transPromiseFactory,R(bn),En,bn)}}function hn(n,t){for(var e=t.db.objectStoreNames,o=0;o<e.length;++o)for(var i=e[o],u=t.objectStore(i),a=0;a<u.indexNames.length;++a){var c=u.indexNames[a],s=u.index(c).keyPath,f="string"==typeof s?s:"["+r(s).join("+")+"]";if(n[i]){var l=n[i].idxByName[f];l&&(l.name=c)}}}var dn=s&&s.addons||i.addons,pn=i.dependencies,vn=pn.indexedDB,mn=pn.IDBKeyRange,gn=(pn.IDBTransaction,pn.DOMError,pn.TypeError),yn=pn.Error,bn=this._dbSchema={},_n=[],wn=[],xn={},Pn={},Sn=null,Dn=!0,kn=null,On=!1,Cn="readonly",En="readwrite",Tn=this,jn=[],Kn=!0,In=!!q();this.version=function(n){if(Sn)throw new yn("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var t=_n.filter(function(t){return t._cfg.version===n})[0];return t?t:(t=new g(n),_n.push(t),_n.sort(nn),t)},t(g.prototype,{stores:function(n){this._cfg.storesSource=this._cfg.storesSource?t(this._cfg.storesSource,n):n;var e={};_n.forEach(function(n){t(e,n._cfg.storesSource)});var r=this._cfg.dbschema={};return this._parseStoresSpec(e,r),bn=Tn._dbSchema=r,en([xn,Tn,Pn]),tn([Pn],H,R(r),En,r),tn([xn,Tn,this._cfg.tables],Tn._transPromiseFactory,R(r),En,r,!0),wn=R(r),this},upgrade:function(n){var t=this;return L(function(){n(Tn._createTransaction(En,R(t._cfg.dbschema),t._cfg.dbschema))}),this._cfg.contentUpgrade=n,this},_parseStoresSpec:function(n,t){R(n).forEach(function(e){if(null!==n[e]){var r={},o=on(n[e]),i=o.shift();if(i.multi)throw new yn("Primary key cannot be multi-valued");i.keyPath&&P(r,i.keyPath,i.auto?0:i.keyPath),o.forEach(function(n){if(n.auto)throw new yn("Only primary key can be marked as autoIncrement (++)");if(!n.keyPath)throw new yn("Index must have a name and cannot be an empty string");P(r,n.keyPath,n.compound?n.keyPath.map(function(){return""}):"")}),t[e]=new N(e,i,o,r)}})}}),this._allTables=xn,this._tableFactory=function(n,t,e){return n===Cn?new Y(t.name,e,t,Z):new G(t.name,e,t)},this._createTransaction=function(n,t,e,r){return new Q(n,t,e,r)},this._transPromiseFactory=function(n,t,e){if(!Dn||W.PSD&&W.PSD.letThrough){var r=Tn._createTransaction(n,t,bn);return r._promise(n,function(n,t){r.error(function(n){Tn.on("error").fire(n)}),W.newPSD(function(){W.PSD.trans=r,e(function(t){r.complete(function(){n(t)})},t,r)})})}On||Tn.open();var o=new W(function(r,i){jn.push({resume:function(){var u=Tn._transPromiseFactory(n,t,e);o.onuncatched=u.onuncatched,u.then(r,i)}})});return o},this._whenReady=function(n){return J||!Dn||W.PSD&&W.PSD.letThrough?new W(n):(On||Tn.open(),new W(function(t,e){jn.push({resume:function(){n(t,e)}})}))},this.verno=0,this.open=function(){return new W(function(t,e){function r(n){try{o.transaction.abort()}catch(t){}On=!1,kn=n,Dn=!1,e(kn),jn.forEach(function(n){n.resume()}),jn=[]}if(J&&t(Tn),Sn)return void t(Tn);if(On)return void Tn._whenReady(function(){t(Tn)},function(n){e(n)});var o,i=!1;try{if(kn=null,On=!0,_n.length>0&&(Kn=!1),!vn)throw new yn("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(o=Kn?vn.open(n):vn.open(n,Math.round(10*Tn.verno)),!o)throw new yn("IndexedDB API not available");o.onerror=T(r,["opening database",n]),o.onblocked=function(n){Tn.on("blocked").fire(n)},o.onupgradeneeded=_(function(t){if(Kn&&!Tn._allowEmptyDB){o.onerror=function(n){n.preventDefault()},o.transaction.abort(),o.result.close();var e=vn.deleteDatabase(n);e.onsuccess=e.onerror=function(){r(new yn("Database '"+n+"' doesnt exist"))}}else{0===t.oldVersion&&(i=!0),o.transaction.onerror=T(r);var u=t.oldVersion>Math.pow(2,62)?0:t.oldVersion;b(u/10,o.transaction,r,o)}},r),o.onsuccess=_(function(e){On=!1,Sn=o.result,Kn?ln():Sn.objectStoreNames.length>0&&hn(bn,Sn.transaction(F(Sn.objectStoreNames),Cn)),Sn.onversionchange=Tn.on("versionchange").fire,In||I(function(t){return-1===t.indexOf(n)?t.push(n):void 0}),W.newPSD(function(){function n(){Dn=!1,jn.forEach(function(n){n.resume()}),jn=[],t(Tn)}W.PSD.letThrough=!0;try{var e=Tn.on.ready.fire();e&&"function"==typeof e.then?e.then(n,function(n){Sn.close(),Sn=null,r(n)}):y(n)}catch(o){r(o)}})},r)}catch(u){r(u)}})},this.close=function(){Sn&&(Sn.close(),Sn=null,Dn=!0,kn=null)},this["delete"]=function(){var t=arguments;return new W(function(e,r){function o(){Tn.close();var t=vn.deleteDatabase(n);t.onsuccess=function(){In||I(function(t){var e=t.indexOf(n);return e>=0?t.splice(e,1):void 0}),e()},t.onerror=T(r,["deleting",n]),t.onblocked=function(){Tn.on("blocked").fire()}}if(t.length>0)throw new yn("Arguments not allowed in db.delete()");On?jn.push({resume:o}):o()})},this.backendDB=function(){return Sn},this.isOpen=function(){return null!==Sn},this.hasFailed=function(){return null!==kn},this.dynamicallyOpened=function(){return Kn},this.name=n,Object.defineProperty(this,"tables",{get:function(){return R(xn).map(function(n){return xn[n]})}}),this.on=m(this,"error","populate","blocked",{ready:[v,u],versionchange:[d,u]}),this.on.ready.subscribe=o(this.on.ready.subscribe,function(n){return function(t,e){function r(){return e||Tn.on.ready.unsubscribe(r),t.apply(this,arguments)}n.call(this,r),Tn.isOpen()&&(Dn?jn.push({resume:r}):r())}}),L(function(){Tn.on("populate").fire(Tn._createTransaction(En,wn,bn)),Tn.on("error").fire(new yn)}),this.transaction=function(n,t,e){function i(t,r){var i=null;try{if(s)throw s;i=Tn._createTransaction(n,f,bn,u);var a=f.map(function(n){return i.tables[n]});a.push(i);var c,l=0;W.newPSD(function(){W.PSD.trans=i,i.scopeFunc=e,u&&(i.idbtrans=u.idbtrans,i._promise=o(i._promise,function(n){return function(t,e,r){function o(n){return function(t){var e;return W._rootExec(function(){e=n(t),W._tickFinalize(function(){0===--l&&i.active&&(i.active=!1,i.on.complete.fire())})}),e}}return++l,n.call(this,t,function(n,t,r){return e(o(n),o(t),r)},r)}})),i.complete(function(){t(c)}),i.error(function(n){i.idbtrans&&(i.idbtrans.onerror=K);try{i.abort()}catch(t){}u&&(u.active=!1,u.on.error.fire(n));var e=r(n);u||e||Tn.on.error.fire(n)}),W._rootExec(function(){c=e.apply(i,a)})}),(!i.idbtrans||u&&0===l)&&i._nop()}catch(h){i&&i.idbtrans&&(i.idbtrans.onerror=K),i&&i.abort(),u&&u.on.error.fire(h),y(function(){r(h)||Tn.on("error").fire(h)})}}t=r(arguments,1,arguments.length-1),e=arguments[arguments.length-1];var u=W.PSD&&W.PSD.trans;u&&u.db===Tn&&-1===n.indexOf("!")||(u=null);var a=-1!==n.indexOf("?");n=n.replace("!","").replace("?","");var c=M(t[0])?t.reduce(function(n,t){return n.concat(t)}):t,s=null,f=c.map(function(n){return"string"==typeof n?n:(n instanceof Y||(s=s||new gn("Invalid type. Arguments following mode must be instances of Table or String")),n.name)});return"r"==n||n==Cn?n=Cn:"rw"==n||n==En?n=En:s=new yn("Invalid transaction mode: "+n),u&&(s||(u&&u.mode===Cn&&n===En&&(a?u=null:s=s||new yn("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),u&&f.forEach(function(n){u.tables.hasOwnProperty(n)||(a?u=null:s=s||new yn("Table "+n+" not included in parent transaction. Parent Transaction function: "+u.scopeFunc.toString()))}))),u?u._promise(n,i,"lock"):Tn._whenReady(i)},this.table=function(n){if(J&&Kn)return new G(n);if(!xn.hasOwnProperty(n))throw new yn("Table does not exist");return xn[n]},t(Y.prototype,function(){function n(){throw new yn("Current Transaction is READONLY")}return{_trans:function(n,t,e){return this._tpf(n,[this.name],t,e)},_idbstore:function(n,t,e){if(J)return new W(t);var r=this;return this._tpf(n,[this.name],function(n,e,o){t(n,e,o.idbtrans.objectStore(r.name),o)},e)},get:function(n,t){var e=this;return this._idbstore(Cn,function(t,r,o){J&&t(e.schema.instanceTemplate);var i=o.get(n);i.onerror=T(r,["getting",n,"from",e.name]),i.onsuccess=function(){t(e.hook.reading.fire(i.result))}}).then(t)},where:function(n){return new X(this,n)},count:function(n){return this.toCollection().count(n)},offset:function(n){return this.toCollection().offset(n)},limit:function(n){return this.toCollection().limit(n)},reverse:function(){return this.toCollection().reverse()},filter:function(n){return this.toCollection().and(n)},each:function(n){var t=this;return J&&n(t.schema.instanceTemplate),this._idbstore(Cn,function(e,r,o){var i=o.openCursor();i.onerror=T(r,["calling","Table.each()","on",t.name]),rn(i,null,n,e,r,t.hook.reading.fire)})},toArray:function(n){var t=this;return this._idbstore(Cn,function(n,e,r){J&&n([t.schema.instanceTemplate]);var o=[],i=r.openCursor();i.onerror=T(e,["calling","Table.toArray()","on",t.name]),rn(i,null,function(n){o.push(n)},function(){n(o)},e,t.hook.reading.fire)}).then(n)},orderBy:function(n){return new this._collClass(new X(this,n))},toCollection:function(){return new this._collClass(new X(this))},mapToClass:function(n,t){this.schema.mappedClass=n;var e=Object.create(n.prototype);t&&E(e,t),this.schema.instanceTemplate=e;var r=function(t){if(!t)return t;var e=Object.create(n.prototype);for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),n},defineClass:function(n){return this.mapToClass(i.defineClass(n),n)},add:n,put:n,"delete":n,clear:n,update:n}}),e(G).from(Y).extend(function(){function n(n,t,e,r){return function(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),n.push(o.target.error),e&&e.onerror&&W.newPSD(function(){W.PSD.trans=r,e.onerror(o.target.error)}),t&&t(n)}}function t(n,t,e,r){return e?function(o){e.onsuccess&&W.newPSD(function(){W.PSD.trans=r,e.onsuccess(o.target.result)}),t&&t(n)}:function(){t(n)}}return{bulkAdd:function(e){var r=this.hook.creating.fire;return this._idbstore(En,function(o,i,a,c){if(!a.keyPath)throw new yn("bulkAdd() only support inbound keys");if(0===e.length)return o([]);var s,f,l,h=[];if(r!==u){var d=a.keyPath,p={onerror:null,onsuccess:null};f=n(h,null,p,c),l=t(h,null,p,c);for(var v=0,m=e.length;m>v;++v){var g=e[v],y=x(g,d),b=r.call(p,y,g,c);void 0===y&&void 0!==b&&(g=k(g),P(g,d,b)),s=a.add(g),m-1>v&&(s.onerror=f,p.onsuccess&&(s.onsuccess=l),p.onerror=null,p.onsuccess=null)}s.onerror=n(h,o,p,c),s.onsuccess=t(h,o,p,c)}else{f=n(h);for(var v=0,m=e.length;m>v;++v)s=a.add(e[v]),s.onerror=f;s.onerror=n(h,o),s.onsuccess=t(h,o)}})},add:function(n,t){var e=this,r=this.hook.creating.fire;return this._idbstore(En,function(o,i,a,c){var s={onsuccess:null,onerror:null};if(r!==u){var f=t||(a.keyPath?x(n,a.keyPath):void 0),l=r.call(s,f,n,c);void 0===f&&void 0!==l&&(a.keyPath?P(n,a.keyPath,l):t=l)}var h=t?a.add(n,t):a.add(n);h.onerror=T(function(n){return s.onerror&&W.newPSD(function(){W.PSD.trans=c,s.onerror(n)}),i(n)},["adding",n,"into",e.name]),h.onsuccess=function(t){var e=a.keyPath;e&&P(n,e,t.target.result),s.onsuccess&&W.newPSD(function(){W.PSD.trans=c,s.onsuccess(t.target.result)}),o(h.result)}})},put:function(n,t){var e=this,r=this.hook.creating.fire,o=this.hook.updating.fire;return r!==u||o!==u?this._trans(En,function(r,o,i){var u=t||e.schema.primKey.keyPath&&x(n,e.schema.primKey.keyPath);void 0===u?i.tables[e.name].add(n).then(r,o):(i._lock(),n=k(n),i.tables[e.name].where(":id").equals(u).modify(function(t){this.value=n}).then(function(r){return 0===r?i.tables[e.name].add(n,t):u})["finally"](function(){i._unlock()}).then(r,o))}):this._idbstore(En,function(r,o,i){var u=t?i.put(n,t):i.put(n);u.onerror=T(o,["putting",n,"into",e.name]),u.onsuccess=function(t){var e=i.keyPath;e&&P(n,e,t.target.result),r(u.result)}})},"delete":function(n){return this.hook.deleting.subscribers.length?this.where(":id").equals(n)["delete"]():this._idbstore(En,function(t,e,r){var o=r["delete"](n);o.onerror=T(e,["deleting",n,"from",r.name]),o.onsuccess=function(n){t(o.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection()["delete"]():this._idbstore(En,function(n,t,e){var r=e.clear();r.onerror=T(t,["clearing",e.name]),r.onsuccess=function(t){n(r.result)}})},update:function(n,t){if("object"!=typeof t||M(t))throw new yn("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof n||M(n))return this.where(":id").equals(n).modify(t);R(t).forEach(function(e){P(n,e,t[e])});var e=x(n,this.schema.primKey.keyPath);return void 0===e&&W.reject(new yn("Object does not contain its primary key")),this.where(":id").equals(e).modify(t)}}}),t(Q.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&W.PSD&&(W.PSD.lockOwnerFor=this),this},_unlock:function(){if(0===--this._reculock)for(W.PSD&&(W.PSD.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var n=this._blockedFuncs.shift();try{n()}catch(t){}}return this},_locked:function(){return this._reculock&&(!W.PSD||W.PSD.lockOwnerFor!==this)},_nop:function(n){this.tables[this.storeNames[0]].get(0).then(n)},_promise:function(n,t,e){var r=this;return W.newPSD(function(){var o;return r._locked()?o=new W(function(o,i){r._blockedFuncs.push(function(){r._promise(n,t,e).then(o,i)})}):(o=r.active?new W(function(o,u){if(!r.idbtrans&&n){if(!Sn)throw new yn(kn?"Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+kn:"Database not open");var a=r.idbtrans=Sn.transaction(F(r.storeNames),r.mode);a.onerror=function(n){r.on("error").fire(n&&n.target.error),n.preventDefault(),r.abort()},a.onabort=function(n){y(function(){r.on("error").fire(new yn("Transaction aborted for unknown reason"))}),r.active=!1,r.on("abort").fire(n)},a.oncomplete=function(n){r.active=!1,r.on("complete").fire(n)}}e&&r._lock();try{t(o,u,r)}catch(c){i.ignoreTransaction(function(){r.on("error").fire(c)}),r.abort(),u(c)}}):W.reject(j(new yn("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString()))),r.active&&e&&o["finally"](function(){r._unlock()})),o.onuncatched=function(n){i.ignoreTransaction(function(){r.on("error").fire(n)}),r.abort()},o})},complete:function(n){return this.on("complete",n)},error:function(n){return this.on("error",n)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new yn("Transaction Aborted"))}catch(n){}},table:function(n){if(!this.tables.hasOwnProperty(n))throw new yn("Table "+n+" not in transaction");return this.tables[n]}}),t(X.prototype,function(){function n(n,t){try{throw t}catch(e){n._ctx.error=e}return n}function t(n){return r(1===n.length&&M(n[0])?n[0]:n)}function e(n){return"next"===n?function(n){return n.toUpperCase()}:function(n){return n.toLowerCase()}}function o(n){return"next"===n?function(n){return n.toLowerCase()}:function(n){return n.toUpperCase()}}function i(n,t,e,r,o,i){for(var u=Math.min(n.length,r.length),a=-1,c=0;u>c;++c){var s=t[c];if(s!==r[c])return o(n[c],e[c])<0?n.substr(0,c)+e[c]+e.substr(c+1):o(n[c],r[c])<0?n.substr(0,c)+r[c]+e.substr(c+1):a>=0?n.substr(0,a)+t[a]+e.substr(a+1):null;o(n[c],s)<0&&(a=c)}return u<r.length&&"next"===i?n+e.substr(n.length):u<n.length&&"prev"===i?n.substr(0,e.length):0>a?null:n.substr(0,a)+r[a]+e.substr(a+1)}function u(n,t,r){function u(n){a=e(n),c=o(n),s="next"===n?un:an,f=a(r),l=c(r),h=n}var a,c,s,f,l,h;u("next"),n._ondirectionchange=function(n){u(n)},n._addAlgorithm(function(n,e,r){var o=n.key;if("string"!=typeof o)return!1;var u=c(o);if(t(u,l))return e(function(){n["continue"]()}),!0;var a=i(o,u,f,l,s,h);return e(a?function(){n["continue"](a)}:r),!1})}return{between:function(n,t,e,r){return e=e!==!1,r=r===!0,n>t||n===t&&(e||r)&&(!e||!r)?new this._ctx.collClass(this,function(){return mn.only(n)}).limit(0):new this._ctx.collClass(this,function(){return mn.bound(n,t,!e,!r)})},equals:function(n){return new this._ctx.collClass(this,function(){return mn.only(n)})},above:function(n){return new this._ctx.collClass(this,function(){return mn.lowerBound(n,!0)})},aboveOrEqual:function(n){return new this._ctx.collClass(this,function(){return mn.lowerBound(n)})},below:function(n){return new this._ctx.collClass(this,function(){return mn.upperBound(n,!0)})},belowOrEqual:function(n){return new this._ctx.collClass(this,function(){return mn.upperBound(n)})},startsWith:function(t){return"string"!=typeof t?n(new this._ctx.collClass(this),new gn("String expected")):this.between(t,t+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(t){if("string"!=typeof t)return n(new this._ctx.collClass(this),new gn("String expected"));if(""===t)return this.startsWith(t);var e=new this._ctx.collClass(this,function(){return mn.bound(t.toUpperCase(),t.toLowerCase()+String.fromCharCode(65535))});return u(e,function(n,t){return 0===n.indexOf(t)},t),e._ondirectionchange=function(){n(e,new yn("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},e},equalsIgnoreCase:function(t){if("string"!=typeof t)return n(new this._ctx.collClass(this),new gn("String expected"));var e=new this._ctx.collClass(this,function(){return mn.bound(t.toUpperCase(),t.toLowerCase())});return u(e,function(n,t){return n===t},t),e},anyOf:function(n){var e=this._ctx,r=e.table.schema,o=e.index?r.idxByName[e.index]:r.primKey,i=o&&o.compound,u=t(arguments),a=i?cn(un):un;if(u.sort(a),0===u.length)return new this._ctx.collClass(this,function(){return mn.only("")}).limit(0);var c=new this._ctx.collClass(this,function(){return mn.bound(u[0],u[u.length-1])});c._ondirectionchange=function(n){a="next"===n?un:an,i&&(a=cn(a)),u.sort(a)};var s=0;return c._addAlgorithm(function(n,t,e){for(var r=n.key;a(r,u[s])>0;)if(++s,s===u.length)return t(e),!1;return 0===a(r,u[s])?(t(function(){n["continue"]()}),!0):(t(function(){n["continue"](u[s])}),!1)}),c},notEqual:function(n){return this.below(n).or(this._ctx.index).above(n)},noneOf:function(n){var e=this._ctx,r=e.table.schema,o=e.index?r.idxByName[e.index]:r.primKey,i=o&&o.compound,u=t(arguments);if(0===u.length)return new this._ctx.collClass(this);var a=i?cn(un):un;u.sort(a);var c=u.reduce(function(n,t){return n?n.concat([[n[n.length-1][1],t]]):[[null,t]]},null);c.push([u[u.length-1],null]);var s=this,f=e.index;return c.reduce(function(n,t){return n?null===t[1]?n.or(f).above(t[0]):n.or(f).between(t[0],t[1],!1,!1):s.below(t[1])},null)},startsWithAnyOf:function(e){function r(n){return n>a[s]}function o(n){return n<u[s]}var i=this._ctx,u=t(arguments);if(!u.every(function(n){return"string"==typeof n}))return n(new i.collClass(this),new gn("startsWithAnyOf() only works with strings"));if(0===u.length)return new i.collClass(this,function(){return mn.only("")}).limit(0);var a=u.map(function(n){return n+String.fromCharCode(65535)}),c=un;u.sort(c);var s=0,f=r,l=new i.collClass(this,function(){return mn.bound(u[0],u[u.length-1]+String.fromCharCode(65535))});return l._ondirectionchange=function(n){"next"===n?(f=r,c=un):(f=o,c=an),u.sort(c),a.sort(c)},l._addAlgorithm(function(n,t,e){for(var r=n.key;f(r);)if(++s,s===u.length)return t(e),!1;return r>=u[s]&&r<=a[s]?(t(function(){n["continue"]()}),!0):(t(function(){c===un?n["continue"](u[s]):n["continue"](a[s])}),!1)}),l}}}),t(Z.prototype,function(){function n(n,t){n.filter=sn(n.filter,t)}function t(n,t){n.isMatch=sn(n.isMatch,t)}function e(n,t){if(n.isPrimKey)return t;var e=n.table.schema.idxByName[n.index];if(!e)throw new yn("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return n.isPrimKey?t:t.index(e.name)}function r(n,t){return e(n,t)[n.op](n.range||null,n.dir+n.unique)}function o(n,t,e,o,i){n.or?!function(){function u(){2===++f&&e()}function a(n,e,r){if(!c||c(e,r,u,o)){var i=e.primaryKey.toString();s.hasOwnProperty(i)||(s[i]=!0,t(n,e,r))}}var c=n.filter,s={},f=(n.table.schema.primKey.keyPath,0);n.or._iterate(a,u,o,i),rn(r(n,i),n.algorithm,a,u,o,n.table.hook.reading.fire)}():rn(r(n,i),sn(n.algorithm,n.filter),t,e,o,n.table.hook.reading.fire)}function i(n){return n.table.schema.instanceTemplate}return{_read:function(n,t){var e=this._ctx;return e.error?e.table._trans(null,function(n,t){t(e.error)}):e.table._idbstore(Cn,n).then(t)},_write:function(n){var t=this._ctx;return t.error?t.table._trans(null,function(n,e){e(t.error)}):t.table._idbstore(En,n,"locked")},_addAlgorithm:function(n){var t=this._ctx;t.algorithm=sn(t.algorithm,n)},_iterate:function(n,t,e,r){return o(this._ctx,n,t,e,r)},each:function(n){var t=this._ctx;return J&&n(i(t)),this._read(function(e,r,i){o(t,n,e,r,i)})},count:function(n){if(J)return W.resolve(0).then(n);var t=this,r=this._ctx;if(r.filter||r.algorithm||r.or){var i=0;return this._read(function(n,t,e){o(r,function(){return++i,!1},function(){n(i)},t,e)},n)}return this._read(function(n,o,i){var u=e(r,i),a=r.range?u.count(r.range):u.count();a.onerror=T(o,["calling","count()","on",t.name]),a.onsuccess=function(t){n(Math.min(t.target.result,Math.max(0,r.limit-r.offset)))}},n)},sortBy:function(n,t){function e(n,t){return t?e(n[o[t]],t-1):n[i]}function r(n,t){var r=e(n,u),o=e(t,u);return o>r?-a:r>o?a:0}var o=(this._ctx,n.split(".").reverse()),i=o[0],u=o.length-1,a="next"===this._ctx.dir?1:-1;return this.toArray(function(n){return n.sort(r)}).then(t)},toArray:function(n){var t=this._ctx;return this._read(function(n,e,r){J&&n([i(t)]);var u=[];o(t,function(n){u.push(n)},function(){n(u)},e,r)},n)},offset:function(t){var e=this._ctx;return 0>=t?this:(e.offset+=t,e.or||e.algorithm||e.filter?n(e,function(n,e,r){return--t<0}):n(e,function(n,e,r){return 0===t?!0:1===t?(--t,!1):(e(function(){n.advance(t),t=0}),!1)}),this)},limit:function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),n(this._ctx,function(n,e,r){return--t<=0&&e(r),t>=0}),this},until:function(t,e){var r=this._ctx;return J&&t(i(r)),n(this._ctx,function(n,r,o){return t(n.value)?(r(o),e):!0}),this},first:function(n){return this.limit(1).toArray(function(n){return n[0]}).then(n)},last:function(n){return this.reverse().first(n)},and:function(e){return J&&e(i(this._ctx)),n(this._ctx,function(n){return e(n.value)}),t(this._ctx,e),this},or:function(n){return new X(this._ctx.table,n,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(n){var t=this._ctx;return J&&n(x(i(this._ctx),this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:this._ctx.table.schema.primKey.keyPath)),t.isPrimKey||(t.op="openKeyCursor"),this.each(function(t,e){n(e.key,e)})},eachUniqueKey:function(n){return this._ctx.unique="unique",this.eachKey(n)},keys:function(n){var t=this._ctx;t.isPrimKey||(t.op="openKeyCursor");var e=[];return J?new W(this.eachKey.bind(this)).then(function(n){return[n]}).then(n):this.each(function(n,t){e.push(t.key)}).then(function(){return e}).then(n)},uniqueKeys:function(n){return this._ctx.unique="unique",this.keys(n)},firstKey:function(n){return this.limit(1).keys(function(n){return n[0]}).then(n)},lastKey:function(n){return this.reverse().firstKey(n)},distinct:function(){var t={};return n(this._ctx,function(n){var e=n.primaryKey.toString(),r=t.hasOwnProperty(e);return t[e]=!0,!r}),this}}}),e($).from(Z).extend({modify:function(n){var e=this,r=this._ctx,o=r.table.hook,i=o.updating.fire,a=o.deleting.fire;return J&&"function"==typeof n&&n.call({value:r.table.schema.instanceTemplate},r.table.schema.instanceTemplate),this._write(function(o,c,s,f){function l(n,t,e){function o(n){return S.push(n),C.push(i.primKey),i.onerror&&W.newPSD(function(){W.PSD.trans=f,i.onerror(n)}),d(),!0}E=t.primaryKey;var i={primKey:t.primaryKey,value:n,onsuccess:null,onerror:null};if(p.call(i,n)!==!1){var u=!i.hasOwnProperty("value");++y,w(function(){var e=u?t["delete"]():t.update(i.value);e.onerror=T(o,u?["deleting",n,"from",r.table.name]:["modifying",n,"on",r.table.name]),e.onsuccess=function(n){i.onsuccess&&W.newPSD(function(){W.PSD.trans=f,i.onsuccess(i.value)}),++b,d()}},o)}else i.onsuccess&&i.onsuccess(i.value)}function h(n){return n&&(S.push(n),C.push(E)),c(new A("Error modifying one or more objects",S,b,C))}function d(){_&&b+S.length===y&&(S.length>0?h():o(b))}var p;if("function"==typeof n)p=i===u&&a===u?n:function(t){var e=k(t);if(n.call(this,t)===!1)return!1;if(this.hasOwnProperty("value")){var r=O(e,this.value),o=i.call(this,r,this.primKey,e,f);o&&(t=this.value,R(o).forEach(function(n){P(t,n,o[n])}))}else a.call(this,this.primKey,t,f)};else if(i===u){var v=R(n),m=v.length;p=function(t){for(var e=!1,r=0;m>r;++r){var o=v[r],i=n[o];x(t,o)!==i&&(P(t,o,i),e=!0)}return e}}else{var g=n;n=D(g),p=function(e){var r=!1,o=i.call(this,n,this.primKey,k(e),f);return o&&t(n,o),R(n).forEach(function(t){var o=n[t];x(e,t)!==o&&(P(e,t,o),r=!0)}),o&&(n=D(g)),r}}var y=0,b=0,_=!1,S=[],C=[],E=null;e._iterate(l,function(){_=!0,d()},h,s)})},"delete":function(){return this.modify(function(){delete this.value})}}),t(this,{Collection:Z,Table:Y,Transaction:Q,Version:g,WhereClause:X,WriteableCollection:$,WriteableTable:G}),h(),dn.forEach(function(n){n(Tn)})}function u(){}function a(n){return n}function c(n,t){return n===a?t:function(e){return t(n(e))}}function s(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function f(n,t){
return n===u?t:function(){var e=n.apply(this,arguments);void 0!==e&&(arguments[0]=e);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?s(r,this.onsuccess):r),o&&(this.onerror=this.onerror?s(o,this.onerror):o),void 0!==i?i:e}}function l(n,e){return n===u?e:function(){var r=n.apply(this,arguments);void 0!==r&&t(arguments[0],r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var u=e.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?s(o,this.onsuccess):o),i&&(this.onerror=this.onerror?s(i,this.onerror):i),void 0===r?void 0===u?void 0:u:void 0===u?r:t(r,u)}}function h(n,t){return n===u?t:function(){return n.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function d(n,t){return n===u?t:function(){return t.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function p(n,t){return n===u?t:function(){n.apply(this,arguments),t.apply(this,arguments)}}function v(n,t){return n===u?t:function(){var e=n.apply(this,arguments);if(e&&"function"==typeof e.then){var r=this,o=arguments;return e.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}function m(n,t){function e(n,t,e){if(M(n))return i(n);if("object"==typeof n)return o(n);t||(t=h),e||(e=u);var r={subscribers:[],fire:e,subscribe:function(n){r.subscribers.push(n),r.fire=t(r.fire,n)},unsubscribe:function(n){r.subscribers=r.subscribers.filter(function(t){return t!==n}),r.fire=r.subscribers.reduce(t,e)}};return c[n]=s[n]=r,r}function o(n){R(n).forEach(function(t){var r=n[t];if(M(r))e(t,n[t][0],n[t][1]);else{if("asap"!==r)throw new Error("Invalid event config");var o=e(t,null,function(){var n=arguments;o.subscribers.forEach(function(t){y(function(){t.apply(global,n)})})});o.subscribe=function(n){-1===o.subscribers.indexOf(n)&&o.subscribers.push(n)},o.unsubscribe=function(n){var t=o.subscribers.indexOf(n);-1!==t&&o.subscribers.splice(t,1)}}})}function i(n){function t(){return r?!1:void(r=!0)}var r=!1;n.forEach(function(n){e(n).subscribe(t)})}var a=arguments,c={},s=function(t,e){if(e){var o=r(arguments,1),i=c[t];return i.subscribe.apply(i,o),n}return"string"==typeof t?c[t]:void 0};s.addEventType=e;for(var f=1,l=a.length;l>f;++f)e(a[f]);return s}function g(n){if(!n)throw new Error("Assertion failed")}function y(n){global.setImmediate?setImmediate(n):setTimeout(n,0)}function b(n){var t=setTimeout(n,1e3);clearTimeout(t)}function _(n,t,e){return function(){var r=W.PSD;W.PSD=e;try{n.apply(this,arguments)}catch(o){t(o)}finally{W.PSD=r}}}function w(n,t){try{n()}catch(e){t(e)}}function x(n,t){if(n.hasOwnProperty(t))return n[t];if(!t)return n;if("string"!=typeof t){for(var e=[],r=0,o=t.length;o>r;++r){var i=x(n,t[r]);e.push(i)}return e}var u=t.indexOf(".");if(-1!==u){var a=n[t.substr(0,u)];return void 0===a?void 0:x(a,t.substr(u+1))}return void 0}function P(n,t,e){if(n&&void 0!==t)if("string"!=typeof t&&"length"in t){g("string"!=typeof e&&"length"in e);for(var r=0,o=t.length;o>r;++r)P(n,t[r],e[r])}else{var i=t.indexOf(".");if(-1!==i){var u=t.substr(0,i),a=t.substr(i+1);if(""===a)void 0===e?delete n[u]:n[u]=e;else{var c=n[u];c||(c=n[u]={}),P(c,a,e)}}else void 0===e?delete n[t]:n[t]=e}}function S(n,t){"string"==typeof t?P(n,t,void 0):"length"in t&&[].map.call(t,function(t){P(n,t,void 0)})}function D(n){var t={};for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function k(n){if(!n||"object"!=typeof n)return n;var t;if(M(n)){t=[];for(var e=0,r=n.length;r>e;++e)t.push(k(n[e]))}else if(n instanceof Date)t=new Date,t.setTime(n.getTime());else{t=n.constructor?Object.create(n.constructor.prototype):{};for(var o in n)n.hasOwnProperty(o)&&(t[o]=k(n[o]))}return t}function O(n,t){var e={};for(var r in n)n.hasOwnProperty(r)&&(t.hasOwnProperty(r)?n[r]!==t[r]&&JSON.stringify(n[r])!=JSON.stringify(t[r])&&(e[r]=t[r]):e[r]=void 0);for(var r in t)t.hasOwnProperty(r)&&!n.hasOwnProperty(r)&&(e[r]=t[r]);return e}function C(n){if("function"==typeof n)return new n;if(M(n))return[C(n[0])];if(n&&"object"==typeof n){var t={};return E(t,n),t}return n}function E(n,t){R(t).forEach(function(e){var r=C(t[e]);n[e]=r})}function T(n,t){return function(e){var r=e&&e.target.error||new Error;if(t){var o=" occurred when "+t.map(function(n){switch(typeof n){case"function":return n();case"string":return n;default:return JSON.stringify(n)}}).join(" ");r.name?r.toString=function(){return r.name+o+(r.message?". "+r.message:"")}:r+=o}return n(r),e&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1}}function j(n){try{throw n}catch(t){return t}}function K(n){n.preventDefault()}function I(n){var t,e=i.dependencies.localStorage;if(!e)return n([]);try{t=JSON.parse(e.getItem("Dexie.DatabaseNames")||"[]")}catch(r){t=[]}n(t)&&e.setItem("Dexie.DatabaseNames",JSON.stringify(t))}function B(n,t,e,r,o,i,u){this.name=n,this.keyPath=t,this.unique=e,this.multi=r,this.auto=o,this.compound=i,this.dotted=u;var a="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(e?"&":"")+(r?"*":"")+(o?"++":"")+a}function N(n,t,e,r){this.name=n,this.primKey=t||new B,this.indexes=e||[new B],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=e.reduce(function(n,t){return n[t.name]=t,n},{})}function A(n,t,e,r){this.name="ModifyError",this.failures=t,this.failedKeys=r,this.successCount=e,this.message=t.join("\n")}function F(n){return 1===n.length?n[0]:n}function q(){var n=i.dependencies.indexedDB,t=n&&(n.getDatabaseNames||n.webkitGetDatabaseNames);return t&&t.bind(n)}var M=Array.isArray,R=Object.keys,U=[].slice,W=function(){function n(n,t){g.push([n,r(arguments,1)])}function t(){var n=g;g=[];for(var t=0,e=n.length;e>t;++t){var r=n[t];r[0].apply(global,r[1])}}function e(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],this._catched=!1;var t=this,r=!0;this._PSD=e.PSD;try{h(this,n,function(n){r?p(c,t,n):c(t,n)},function(n){return r?(p(s,t,n),!1):s(t,n)})}finally{r=!1}}function o(r,o){if(null===r._state)return void r._deferreds.push(o);var i=r._state?o.onFulfilled:o.onRejected;if(null===i)return(r._state?o.resolve:o.reject)(r._value);var u,c=v;v=!1,p=n;try{var s=e.PSD;e.PSD=r._PSD,u=i(r._value),r._state||u&&"function"==typeof u.then&&u._state===!1||a(r),o.resolve(u)}catch(f){var l=o.reject(f);if(!l&&r.onuncatched)try{r.onuncatched(f)}catch(f){}}finally{if(e.PSD=s,c){do{for(;g.length>0;)t();var h=y.pop();if(h)try{h()}catch(f){}}while(y.length>0||g.length>0);p=d,v=!0}}}function i(e){var r=v;v=!1,p=n;try{e()}finally{if(r){do{for(;g.length>0;)t();var o=y.pop();if(o)try{o()}catch(i){}}while(y.length>0||g.length>0);p=d,v=!0}}}function a(n){n._catched=!0,n._parent&&a(n._parent)}function c(n,t){var r=e.PSD;e.PSD=n._PSD;try{if(t===n)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)return void h(n,function(n,e){t.then(n,e)},function(t){c(n,t)},function(t){s(n,t)});n._state=!0,n._value=t,f.call(n)}catch(o){s(o)}finally{e.PSD=r}}function s(n,t){var r=e.PSD;if(e.PSD=n._PSD,n._state=!1,n._value=t,f.call(n),!n._catched)try{n.onuncatched&&n.onuncatched(n._value),e.on.error.fire(n._value)}catch(o){}return e.PSD=r,n._catched}function f(){for(var n=0,t=this._deferreds.length;t>n;n++)o(this,this._deferreds[n]);this._deferreds=[]}function l(n,t,e,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=e,this.reject=r}function h(n,t,e,r){var o=!1;try{t(function(n){o||(o=!0,e(n))},function(t){return o?n._catched:(o=!0,r(t))})}catch(i){if(o)return;return r(i)}}var d=global.setImmediate||function(n){var t=r(arguments,1);setTimeout(function(){n.apply(global,t)},0)};b(function(){d=p=n=function(n){var t=arguments;setTimeout(function(){n.apply(global,r(t,1))},0)}});var p=d,v=!0,g=[],y=[];return e.on=m(null,"error"),e.all=function(){var n=r(1===arguments.length&&M(arguments[0])?arguments[0]:arguments);return new e(function(t,e){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,function(n){r(i,n)},e)}n[i]=u,0===--o&&t(n)}catch(c){e(c)}}if(0===n.length)return t([]);for(var o=n.length,i=0;i<n.length;i++)r(i,n[i])})},e.prototype.then=function(n,t){var r=this,i=new e(function(e,i){null===r._state?o(r,new l(n,t,e,i)):p(o,r,new l(n,t,e,i))});return i._PSD=this._PSD,i.onuncatched=this.onuncatched,i._parent=this,i},e.prototype._then=function(n,t){o(this,new l(n,t,u,u))},e.prototype["catch"]=function(n){if(1===arguments.length)return this.then(null,n);var t=arguments[0],r=arguments[1];return"function"==typeof t?this.then(null,function(n){return n instanceof t?r(n):e.reject(n)}):this.then(null,function(n){return n&&n.name===t?r(n):e.reject(n)})},e.prototype["finally"]=function(n){return this.then(function(t){return n(),t},function(t){return n(),e.reject(t)})},e.prototype.onuncatched=null,e.resolve=function(n){if(n&&"function"==typeof n.then)return n;var t=new e(function(){});return t._state=!0,t._value=n,t},e.reject=function(n){var t=new e(function(){});return t._state=!1,t._value=n,t},e.race=function(n){return new e(function(t,e){n.map(function(n){n.then(t,e)})})},e.PSD=null,e.newPSD=function(n){var t=e.PSD;e.PSD=t?Object.create(t):{};try{return n()}finally{e.PSD=t}},e._rootExec=i,e._tickFinalize=function(n){if(v)throw new Error("Not in a virtual tick");y.push(n)},e}(),L=function(){},J=!1;e(A).from(Error),i["delete"]=function(n){var t=new i(n),e=t["delete"]();return e.onblocked=function(n){return t.on("blocked",n),this},e},i.exists=function(n){return new i(n).open().then(function(n){return n.close(),!0},function(){return!1})},i.getDatabaseNames=function(n){return new W(function(n,t){var e=q();if(e){var o=e();o.onsuccess=function(t){n(r(t.target.result,0))},o.onerror=T(t)}else I(function(t){return n(t),!1})}).then(n)},i.defineClass=function(n){function e(e){e?t(this,e):J&&E(this,n)}return e},i.ignoreTransaction=function(n){return W.newPSD(function(){return W.PSD.trans=null,n()})},i.spawn=function(){return global.console&&console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."),i.ignoreTransaction.apply(this,arguments)},i.vip=function(n){return W.newPSD(function(){return W.PSD.letThrough=!0,n()})},Object.defineProperty(i,"currentTransaction",{get:function(){return W.PSD&&W.PSD.trans||null}}),i.Promise=W,i.derive=e,i.extend=t,i.override=o,i.events=m,i.getByKeyPath=x,i.setByKeyPath=P,i.delByKeyPath=S,i.shallowClone=D,i.deepClone=k,i.addons=[],i.fakeAutoComplete=L,i.asap=y,i.ModifyError=A,i.MultiModifyError=A,i.IndexSpec=B,i.TableSchema=N;var V=global.idbModules&&global.idbModules.shimIndexedDB?global.idbModules:{};i.dependencies={indexedDB:V.shimIndexedDB||global.indexedDB||global.mozIndexedDB||global.webkitIndexedDB||global.msIndexedDB,IDBKeyRange:V.IDBKeyRange||global.IDBKeyRange||global.webkitIDBKeyRange,IDBTransaction:V.IDBTransaction||global.IDBTransaction||global.webkitIDBTransaction,Error:global.Error||String,SyntaxError:global.SyntaxError||String,TypeError:global.TypeError||String,DOMError:global.DOMError||String,localStorage:null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:global.localStorage},i.version=1.2,b(function(){i.fakeAutoComplete=L=b,i.fake=J=!0}),n.Dexie=i});
//# sourceMappingURL=Dexie.min.js.map